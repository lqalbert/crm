<extend name="Common:base" />

<block name="head"></block>
<block name="body">
<div id="app" class="container" >
<div class="wrapp" v-show="show" style="display: none;">
	<el-row>
  	<el-col :span="24">
  		<el-form :inline="true" :model="searchForm">
  		  <el-form-item>
  		    <el-input v-model="searchForm.user" placeholder="审批人"></el-input>
  		  </el-form-item><el-form-item>
  		    <el-select v-model="searchForm.region" placeholder="活动区域">
  		      <el-option label="区域一" value="区域一"></el-option>
  		      <el-option label="区域二" value="区域二"></el-option>
  		    </el-select>
  		  </el-form-item><el-form-item>
  		    <el-button >清空</el-button>
  		    <el-button type="primary">查询</el-button> 
          <el-button  >高级查询</el-button> 
  		  </el-form-item>
  		</el-form>
  	</el-col>
  </el-row>

<el-row>
  <el-col :span="24">
  	<el-table :data="dataList" border  height v-loading="dataLoad" element-loading-text="{:L('DATA_LOGIN')}">
	    <el-table-column type="selection"  width="50" >
	    </el-table-column>
	    <el-table-column   label="{:L('INDEX')}"  :formatter="handleIndex" width="70"  >
	    </el-table-column>
	    <el-table-column prop="name"  label="客户姓名" width="140">
	    </el-table-column>
      <el-table-column prop="sex"  label="性别" width="140">
        <template scope="scope">
          {{ getType(scope.row.sex, 'sexType') }}
        </template>
      </el-table-column>
	    <el-table-column prop="type" label="客户类型" width="140" >
        <template scope="scope">
         {{ getType(scope.row.type, 'customerType') }}
        </template>
	    </el-table-column>
	    <el-table-column prop="phone" label="手机" >
	    </el-table-column>
		  <el-table-column prop="qq" label="QQ号" >
	    </el-table-column>
	    <el-table-column prop="qq_nickname" label="QQ昵称" >
	    </el-table-column>
	   <el-table-column  label="地区" >
      <template scope="scope">
           {{ scope.row.province_name+"-"+scope.row.city_name }}
        </template>
	    </el-table-column>
	    <!--<el-table-column  label="跟踪员工" >
	    </el-table-column>
	    <el-table-column  label="跟踪方最后跟踪时间" >
	    </el-table-column>

	    <el-table-column  label="锁定方最后跟踪时间" >
	    </el-table-column> -->

	    <el-table-column inline-template :context="_self"  fixed="right"  label="操作" width="200">
	      <span>
	        <el-button @click="handleEdit($index, row)"  size="small">编辑</el-button>
	        <el-button @click="handleDelete($index, row)"  size="small" type="danger">删除</el-button>
	      </span>
	    </el-table-column>
    </el-table>
  </el-col>
</el-row>

  <!-- toolbar -->
  <el-row type="type"  justify="space-between" align="middle"  class="row-bg">
    <el-col :span="12">
    <div class="grid-content bg-purple">
          <span class="wrapper">
            <el-button size="small"  @click="openDialog('add')" icon="plus" type="primary">{:L('ADD')}</el-button>
            <el-button size="small" >录入跟踪</el-button>
              <!-- <el-button  @click="addCustomer">修改客户</el-button> -->
              <!-- <el-button>计划</el-button>
              <el-button>推介</el-button> -->
          </span>
        </div>
    
    </el-col>
    <el-col :span="12">
    <div class="grid-content bg-purple-light pull-right">

      <!-- page -->
      <include file="Common:_pagination" />
      <!-- / page -->
      
    </div></el-col>
  </el-row>
  <!-- / toolbar -->
</div>

<div class="dialogWrapper" v-show="show" style="display: none">
  <!-- 录入跟踪  -->
  
  <!-- / 录入跟踪 -->

  <!-- 录入客户 -->
  <include file="_add" />
  <!-- / 录入客户 -->
  <!-- 编辑 -->
   <include file="_edit" />
</div>

</div> 
</block>
<block name="scripts">
<script>
function toInt(v){
  return parseInt(v);
}
</script>
<script>
  window.defaultOption.setDatas({
    customerType:{:json_encode($customerType)},
    sexType:{:json_encode($sexType)},
    provinces:[],
    cities:[]
  }).setForm('search', {
    user:'',
    region:''
  }).setForm('add',{
    name:"",
    phone:"",
    qq:"",
    qq_nickname:"",
    weixin:"",
    weixin_nickname:"",
    type:"",
    sex:0,
    area_province:null,
    area_city:null,
    year:1,
    remark:""
  }).setForm('edit',{
    id:"",
    name:"",
    phone:"",
    qq:"",
    qq_nickname:"",
    weixin:"",
    weixin_nickname:"",
    type:"",
    sex:0,
    area_province:null,
    area_city:null,
    year:1,
    remark:""
  }).setMethod('getType', function(type, field){
      return this[field][type];
  }).setMethod('beforeList', function(data){
    data.forEach(function(currentValue){
      currentValue.type  = parseInt(currentValue.type);
    })
    return data;
  }).setMethod('provinceChange', function(v){
    var vmThis = this;
    this.$http.get('{:U("Area/getAreasByPid")}', {params:{pid:v} }).then(function(response){
      var cities = [];
       response.body.forEach(function(currentValue,index){
        cities.push({id: currentValue.id, name: currentValue.name});
       })
       vmThis.$set(vmThis, 'cities', cities);
    });
  }).setMethod('beforeEdit',function(){
    if (!this.$refs['editselect']) {
      this.provinceChange(this.editForm.area_province);
    }
  }).setAdvancedSearch().setVueHook('mounted', function(){
    var vmThis = this;
    this.$http.get('{:U("Area/getAreasByPid")}', {params:{pid:1} }).then(function(response){
      var provinces = [];
      response.body.forEach(function(currentValue,index){
        provinces.push({id: currentValue.id, name: currentValue.name});
      })
      vmThis.$set(vmThis, 'provinces', provinces);
    });
  });
</script>
</block>