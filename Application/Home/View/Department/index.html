<extend name="Common:base" />
<block name="head"></block>
<block name="body">
	<div id="app" class="container">
		<div class="wrapp" v-show="show" style="display: none">
			<!-- seach form -->
			<el-row>
				<el-col :span="12">
					<el-form :inline="true"  ref="searchForm" :model="searchForm">
					  <el-form-item prop="name" >
					    <el-input   placeholder="查询字段一"  v-model="searchForm.name"></el-input>
					    </el-form-item><el-form-item>
					    <el-select v-model="searchForm.input" clearable placeholder="查询字段二">
					      <el-option label="区域一" value="区域一"></el-option>
					      <el-option label="区域二" value="区域二"></el-option>
					    </el-select>
					  </el-form-item>
					  <el-form-item>
					    <el-button icon="close" @click="searchReset"> 清空</el-button>
					    <el-button type="primary" icon="search" @click="loadDatalist" >查询</el-button> 
			        	<el-button  @click="openDialog('advancedSearch')" icon="search">高级查询</el-button> 
					  </el-form-item>
					</el-form>
				</el-col>
				<el-col :span="12">
				</el-col>	
			</el-row>
			<!-- / search form -->

			<!-- datatables  -->
			<el-row>
				<el-col :span="24">
					<el-table 
					:data="dataList" 
					border    
					max-height="600"
					style="width: 100%"
					v-loading="dataLoad"
					element-loading-text="{:L('DATA_LOGIN')}">
					    <el-table-column type="selection"  align="center" width="50" >
					    </el-table-column>
					    <el-table-column label="序号"  align="center" width="65" :formatter="handleIndex"  >
					    </el-table-column>
					    <el-table-column label="单位ID" align="center" prop="id" width="80">
					    </el-table-column>
					    <el-table-column label="单位名" align="center" prop="name" width="120">
					    </el-table-column>
					    <el-table-column label="类型" align="center" prop="type">
					    </el-table-column>
						<el-table-column label="上级组织" align="center" prop="p_name" width="110">
					    </el-table-column>
					    <el-table-column label="片区" align="center" prop="zone">
					    </el-table-column>
					    <el-table-column label="联系人" align="center" prop="contact">
					    </el-table-column>
					    <el-table-column label="联系电话" align="center" prop="tel" width="140">
					    </el-table-column>
					    <el-table-column label="拓展一" align="center" prop="expand1">
					    </el-table-column>
					    <el-table-column  label="拓展二" align="center" prop="expand2">
					    </el-table-column>
					    <el-table-column  inline-template :context="_self"  align="center" label="形象照片" width="100">
						    <div>
						    	<el-tooltip content="点击放大图片" placement="right">
						    	 <img :src="imgUrl(row.img)" @click="bigImg(row.img)" alt="点击放大图片" width="45px" height="45px">
						    	<el-tooltip content="添加新的组织单位！" placement="right">	
						    </div>
					    </el-table-column>
                        <el-table-column label="地址" align="center" prop="address" width="180">
                        </el-table-column>
                        <el-table-column label="财务编号" align="center" prop="f_num" width="100">
                        </el-table-column>
                        <el-table-column label="是否公示" align="center" prop="public" width="100">
                        </el-table-column>
                        <el-table-column label="备注" align="center" prop="remark" width="100">
                        </el-table-column>

					    <el-table-column inline-template :context="_self"  width="150" fixed="right"  label="操作"  >
					      <span>
					        <el-button @click="handleEdit($index, row)"   type="text"  size="small">编辑</el-button>
					        <el-button @click="handleDelete($index, row)" type="text"  size="small" >删除</el-button>
					      </span>
					    </el-table-column>
				    </el-table>
				</el-col>
			</el-row>
			<!-- / datatables  -->
            

			<!-- toolbar -->
			<el-row type="type"  justify="space-between" align="middle"  class="row-bg">
			  <el-col :span="12">
			  <div class="grid-content bg-purple">
			  	<span class="wrapper">
			  		<el-tooltip content="添加新的组织单位！" placement="right">
					    <el-button size="small"  @click="openDialog('add')" icon="plus" type="primary">添加</el-button>
					    <!-- <el-button  @click="">录入客户</el-button>
					    <el-button  @click="">修改客户</el-button> -->
					    <!-- <el-button>计划</el-button>
					    <el-button>推介</el-button> -->
				    </el-tooltip>
				</span>
			  </div>
			  </el-col>
			  <el-col :span="12">
				  <div class="grid-content bg-purple-light pull-right">
				    <!-- page -->
				    <include file="Common:_pagination" />
				    <!-- / page -->
				  </div>
			  </el-col>
			</el-row>
			<!-- / toolbar -->

		</div>

		<div v-show="show" style="display: none">
			<!-- 高级查询 -->
			<include file="_search" />
			<!-- / 高级查询 -->

			<!-- 添加 -->
			<include file="_add" />
			<!-- / 添加 -->

			<!-- 编辑 -->
			<include file="_edit" />
			<!-- / 编辑 -->


			<!-- bigimg -->
			<el-dialog  title="图片放大" :modal="false" size="small" v-model="bigimg" style="z-index:1000;">
			  <div style="margin:0;padding:0;text-align:center;z-index:1000;"><img :src="imageUrl" style="margin-left:-14px;width:850px;height:550px;"></div>
			</el-dialog>
            <!-- bigimg -->
		</div>


	</div>
</block>
<block name="scripts">
<script>
	window.defaultOption.setDatas({
  	    //传输照片上传地址
  	    pathInfo:{folder:'department'},
		//放大图片
        bigimg:false,
        //放大图片地址
        imageUrl:'',

        fileList:[
           {name: '', url: ''}
		],

		rules:{
             name:[
                { required: true, message: '请填写单位名称', trigger: 'blur' },
             ],
             type:[
                { required: true, message: '请选择类型', trigger: 'blur' },
             ],
             zone:[
                { required: true, message: '请选择片区', trigger: 'blur' },
             ],
             contact:[
                { required: true, message: '请填写联系人', trigger: 'blur' },
             ],
             tel:[
                { required: true, message: '请填写联系电话', trigger: 'blur' },
             ],
             public:[
                { required: true, message: '请选择是否公示', trigger: 'blur' },
             ],
             address:[
                { required: true, message: '请填写地址', trigger: 'blur' },
             ],
		}

	}).setForm('add', {
		name:"",
		public:"",
		type:"",
		p_id:"",
		zone:"",
		expand1:"",
		expand2:"",
		contact:"",
		tel:"",
		f_num:"",
		address:"",
		remark:"",
		img:""
	}).setForm('edit', {
		id:"",
		name:"",
		public:"",
		type:"",
		p_id:"",
		zone:"",
		expand1:"",
		expand2:"",
		contact:"",
		tel:"",
		f_num:"",
		address:"",
		remark:"",
		img:"",
	}).setForm('search', {
		name:"",
		input:"",
		sortFiled:"id",
		sortWay:"asc" // desc
	}).setMethod('imgUrl', function(url){
			return "__ROOT__/Upload/department/"+url
	}).setMethod('bigImg', function(url){
		this.bigimg = true;
		this.imageUrl = "__ROOT__/Upload/department/"+url;
	}).setMethod('uploadImg', function(response, file, fileList){
		this.addForm.img = response.path;
		return response.path;
	}).setMethod('uploadImg_E',function(response, file, fileList){
    	this.editForm.img = response.path;
    }).setAdvancedSearch().setMethod("handleEdit", function(index, row){
		//将此行数据赋给editForm
		var type='edit';
		this.initObject(this[FormName.getFormName(type)] , row); 
		//设置显示的图片
		this.fileList = [{name:row.img, url: this.imgUrl(row.img)}];
		this.editIndex = index;
		this.openDialog(type);

	}).setMethod('organization', function(){
		return this.dataList.filter(function (value) {
	      return value.p_id == 0 ;
	    })
	});
</script>



<!-- 
	先写功能 再重构
-->
<script>
//   {$datalist | json_encode}
//
//
	/*var page ={
		dataList:{:json_encode($dataSource['list'])},
		addFormUrl:"{:U('add')}",
		editFormUrl:"{:U('edit')}",
		indexUrl:"{:U('index')}",
		deleteUrl:"{:U('delete')}",
		init:function(){
				this.dataList.forEach(function(currentValue, index){
					
					// currentValue['img']    = "__ROOT__/Upload/"+currentValue['img'];
				})
			}
	}
	page.init();*/

</script>
	<script>
		// vm option 里面的 data属性
		/*Oassign(window.vmData ,{
			

			//高级查询
			advancedSearch: false,
			//添加对话框
			dialogAdd: false,
			dialogEdit: false,
            //放大图片
            bigimg:false,
            //放大图片地址
            imageUrl:'',

			sousuo:'',
			input:'区域一',

			addForm :{
				name:"",
				public:"",
				type:"",
				p_name:"",
				zone:"",
				expand1:"",
				expand2:"",
				contact:"",
				tel:"",
				f_num:"",
				address:"",
				remark:"",
				img:""
			},
			addFormSubmit:false,

			editForm :{
				id:"",
				name:"",
				public:"",
				type:"",
				p_name:"",
				zone:"",
				expand1:"",
				expand2:"",
				contact:"",
				tel:"",
				f_num:"",
				address:"",
				remark:"",
				img:"",

			},
			editFormSubmit:false,
			//编辑默认显示的图片
			fileList:[
               {name: '', url: ''}
			],

			searchForm:{
				p:1,
				sortFiled:"id",
				sortWay:"asc" // desc
			},
			//表单验证
			rules:{
                 name:[
                    { required: true, message: '请填写单位名称', trigger: 'blur' },
                 ],
                 type:[
                    { required: true, message: '请选择类型', trigger: 'blur' },
                 ],
                 zone:[
                    { required: true, message: '请选择片区', trigger: 'blur' },
                 ],
                 contact:[
                    { required: true, message: '请填写联系人', trigger: 'blur' },
                 ],
                 tel:[
                    { required: true, message: '请填写联系电话', trigger: 'blur' },
                 ],
                 public:[
                    { required: true, message: '请选择是否公示', trigger: 'blur' },
                 ],
                 address:[
                    { required: true, message: '请填写地址', trigger: 'blur' },
                 ],
			},
				name:""
			},
			
		});*/

     
		

		//处理编辑
		/*window.vmMethods.set("handleEdit", function(index, row){
			//将此行数据赋给editForm
			this.initObject(this.editForm , row); 
			//设置显示的图片
			this.fileList = [{name:row.img, url: this.imgUrl(row.img)}];
			this.editIndex = index;
			this.dialogEdit = true;

		})*/

	</script>
</block>