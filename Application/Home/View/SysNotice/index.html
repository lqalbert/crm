<extend name="Common:base" />
<block name="head"></block>
<block name="body">
  <div id="app" class="container">
    <div class="wrapp" v-show="show" style="display:none">
      <el-row>
        <el-col :span="12">
          <el-form :inline="true" ref="searchForm" :model="searchForm">
            <el-form-item prop="name">
             <el-input placeholder="请输入标题关键字" v-model="searchForm.name"></el-input>
            </el-form-item>
            <el-form-item>
             <el-button type="primary" icon="search" @click="loadDatalist">查询</el-button>
             <el-tooltip content="清空搜索框并刷新表格数据" placement="right">
              <el-button  @click="searchReset">重置</el-button>
             </el-tooltip>
            </el-form-item>
          </el-form>
        </el-col>

      </el-row>
      <el-row>
        <el-col :span="24">
          <el-table :data="dataList" v-loading="dataLoad"  border  stripe element-loading-text="{:L('DATA_LOGIN')}" ref="select">
            <!-- <el-table-column type="selection" align="center" width="50"></el-table-column> -->
            <el-table-column label="序号"  :formatter="handleIndex" width="65"></el-table-column>
            <el-table-column label="公告类型" prop="type" align="center" width="100">
               <template scope="scope">
                  {{ getType(scope.row.type, 'NoticeType') }}
               </template>
            </el-table-column>
            <el-table-column label="公告标题" prop="title"  width="100"></el-table-column>
            <el-table-column label="公告内容" prop="content" >
              <template scope="scope">
                {{ scope.row.content | handleString(20) }}
              </template>
            </el-table-column>
            <el-table-column label="开始日期" prop="start" align="center" width="180"></el-table-column> 
            <el-table-column label="截止日期" prop="end" align="center" width="180"></el-table-column> 
            <el-table-column label="发布人" prop="user" width="120"></el-table-column>
            <el-table-column label="操作"  align="center" width="180">
               <template scope="scope">
                  <el-button type="success" @click="handleEdit(scope.$index, scope.row)"     size="small">编辑</el-button>
                  <el-button type="danger"  @click="handleDelete(scope.$index, scope.row)"   size="small" >删除</el-button>
               </template>
            </el-table-column>  
          </el-table>
        </el-col>
      </el-row>

      <el-row type="flex"  justify="space-between" align="middle"  class="row-bg">
            <el-col :span="12">
              <div class="grid-content bg-purple">
                 <el-tooltip content="点击填写公告并发布" placement="right">
                   <el-button size="small" type="info" @click="openDialog('add')" icon="edit">发布公告
                   </el-button>
                 </el-tooltip>
              </div>
            </el-col>
            <el-col :span="12">
              <div class="grid-content bg-purple-light pull-right">
            <!-- page -->
            <include file="Common:_pagination" />
            <!-- / page -->
              </div>
            </el-col>
      </el-row>
    </div>

    <div class="dialogWrapper" v-show="show" style="display: none">

      <!-- 添加公告 -->
      <include file="_add" />
      <!-- / 添加公告 -->

      <!-- 编辑 -->
      <include file="_edit" />
      <!-- / 编辑 -->

    </div>

  </div>
</block>
<block name="scripts">
<script>
  window.defaultOption.setDatas({
    NoticeType:{:json_encode($NoticeType)},
    addRules:{
      title:[
         { required: true, message: '请输入公告标题', trigger: 'blur'},
      ],
      type:[
         { required: true, message: '请选择公告类型', trigger: 'blur'},
      ],
    }
  }).setForm('search',{
    name:'',
  }).setForm('add',{
    type:'',
    title:'',
    content:'',
    start:'',
    end:'',
  }).setForm('edit',{
    id:"",
    type:'',
    title:'',
    content:'',
    start:'',
    end:'',
  }).setMethod('getType', function(type, field){
     return this[field][type];
  });
</script>
</block>